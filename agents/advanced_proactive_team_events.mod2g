use common.commonKnowledge as knowledge.
use common.events as module.
use common.com_basic as module.
use common.com_block_info as module.
use common.com_visited as module.
use common.lookahead as module.

module blockComTeamEvents {
	
	if true then comBasic.
	
	if true then comBlocks.
	if true then comVisited.
	
	if true then lookAhead.
	
	if true then events.
	
	forall (Agt).sent( msg(grabbing(BlockID)) ) do insert ( grabbing(Agt, BlockID) ).
	forall (Agt).sent( msg(notGrabbing(BlockID)) ) do delete ( grabbing(Agt, BlockID) ).
	
	if a-goal( delivered(BlockID) ) then insert( grabbing(me, BlockID) ) +
		allother.send(msg(grabbing(BlockID)) ).
	if bel( grabbing(me, BlockID) ), not(a-goal(delivered(BlockID))) then 
		delete( grabbing(me, BlockID) ) + allother.send(msg(notGrabbing(BlockID)) ).
	
	% TODO: update for checking on colour. And count of that colour.
	% If somehow two agents want to deliver the same block. Resolve the conflict.
	forall bel( grabbing(me, BlockID), grabbing(Agt, BlockID), me(Me), Me < Agt ), 
		a-goal( delivered(BlockID) ) do drop (delivered(BlockID)) + 
		delete( grabbing(me, BlockID) ) + allother.send(msg(notGrabbing(BlockID)) ).
}